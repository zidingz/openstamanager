{% extends "layouts/base.twig" %}

{% block body_class %}hold-transition login-page{% endblock %}
{% block title %}{{ "Login"|trans }}{% endblock %}

{% block body %}
    <div class="login-box">
        <div class="login-logo">
            <a href="//openstamanager.com" target="_blank">
                <img src="{{ base_path() }}/assets/img/full_logo.png" style="max-width: 360px">
            </a>
        </div>

        <form novalidate action="" method="post">
            <div class="card">
                <div class="card-body login-card-body">
                    <h4 class="login-box-msg">{{ 'Accedi'|trans }}</h4>

                    {[ "type": "text", "name": "username", "autocomplete": "username", "placeholder": "{{ 'Username'|trans }}", "value": "{{ username }}", "icon-before": "<i class=\"fa fa-user\"></i>", "required": 1 ]}
                    <div class="mb-3"></div>

                    {[ "type": "password", "name": "password", "autocomplete": "current-password", "placeholder": "{{ 'Password'|trans }}", "icon-before": "<i class=\"fa fa-lock\"></i>" ]}
                    <div class="mb-3"></div>

                    <div class="text-right">
                        <a href="{{ base_path() }}/reset.php">{{ 'Dimenticata la password?'|trans }}</a>
                    </div>
                </div>

                <div class="card-footer">
                    <button type="submit" class="btn btn-warning btn-block">{{ 'Accedi'|trans }}</button>
                </div>
            </div>
        </form>
    </div>
{% endblock %}

{% block before_content %}
    {% if is_beta %}
    <div class="clearfix">&nbsp;</div>
    <div class="alert alert-warning alert-dismissable col-md-6 col-md-push-3 text-center fade in">
        <i class="fa fa-warning"></i> <b>{{ 'Attenzione!'|trans }}</b> {{ 'Stai utilizzando una versione <b>non stabile</b> di OSM.'|trans }}

        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">Ã—</button>
    </div>
    {% endif %}

    {% if brute.actual %}
    <div class="card card-outline card-danger card-center" id="brute">
        <div class="card-header text-center">
            <h3 class="card-title">{{ 'Attenzione'|trans }}</h3>
        </div>

        <div class="card-body text-center">
            <p>{{ 'Sono stati effettuati troppi tentativi di accesso consecutivi!'|trans }}</p>
            <p>{{ 'Tempo rimanente (in secondi)'|trans }}: <span id="brute-timeout">{{ brute.timeout + 1 }}</span></p>
        </div>
    </div>
    <script>
        $(document).ready(function(){
            $(".login-box").fadeOut();
            brute();
        });

        function brute() {
            var value = parseFloat($("#brute-timeout").html()) - 1;
            $("#brute-timeout").html(value);

            if(value > 0){
                setTimeout("brute()", 1000);
            } else{
                $("#brute").fadeOut();
                $(".login-box").fadeIn();
            }
        }
    </script>
    {% endif %}

    {% if flash.getMessage('error') is not empty %}
    <script>
        $(document).ready(function(){
            $(".login-box").effect("shake");
        });
    </script>
    {% endif %}
{% endblock %}
